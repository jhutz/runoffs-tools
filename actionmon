#!/usr/bin/perl

use Archive::Zip qw(:ERROR_CODES :CONSTANTS);
use DBI;
use File::Basename;
use Getopt::Std;
use HTML::Parser;
use IO::File;
use IO::Pipe;
use LWP;
use POSIX qw(strftime);
use URI::Escape;
use Text::Wrap;

use strict;
use vars qw($LOGOFILE $LOGOPATH $LOGODATA %ClassKey $LIST);
use vars qw($DEBUG $VERBOSE $GETONLY $MONITOR $REPORT $UPDATE $FORCE);
use vars qw($DBPath $DB $Template $Printer $SERVER $USERID $PASSWD);
use vars qw($URLBase $LoginURL $ListURL $GetURL $UA %FormInputs);

$LOGOFILE = 'scca-runoffs-vir-pos-alpha.eps';
$LOGOPATH = "$ENV{HOME}/runoffs/Images/$LOGOFILE";

$SERVER   = 'racecontrol.scca.com';
$USERID   = 'tandsusr1';
$DBPath   = "$ENV{HOME}/runoffs/Results/actions.db";
$Template = join('', <DATA>);

$Text::Wrap::unexpand = 0;

%ClassKey = (
  '2db7c0ba-8119-489e-9b26-760146e5878f' => 'Testing 10/13 08:30 AS',
  'a5cf5305-cd94-4a2c-aa14-5cc081a4b062' => 'Testing 10/13 08:30 GT1',
  '4e01e65a-53de-4b5a-bd1b-2a7ee8968a1f' => 'Testing 10/13 08:30 GT2',
  '56fbb7ed-e10b-4105-8527-27ffedf2a751' => 'Testing 10/13 08:30 GT3',
  '71033a5c-9497-4405-ad0c-4e35a5eac6c6' => 'Testing 10/13 08:30 STU',
  'b8382554-245b-4647-adbf-cf2839e187a7' => 'Testing 10/13 08:30 T1',
  'f4f8be07-bc68-4731-88b1-cb2e010cd238' => 'Testing 10/13 08:30 T2',
  '35914ada-e68c-405b-91f2-85164abd8969' => 'Testing 10/13 09:00 B-Spec',
  '47161a76-7b78-403d-bb01-929d4791c919' => 'Testing 10/13 09:00 EP',
  '7fd1d42e-2d4c-4dca-9a31-088aea9d8b79' => 'Testing 10/13 09:00 FP',
  '1b1b196f-1511-4ab0-8883-23a480621aa1' => 'Testing 10/13 09:00 GTL',
  '94305a4a-708b-4709-b318-7cf82e327b37' => 'Testing 10/13 09:00 HP',
  '9a5945df-c762-4927-831d-51874881e567' => 'Testing 10/13 09:00 SM',
  '99b1d73f-6a17-4cc2-a1a7-26da93efe151' => 'Testing 10/13 09:00 STL',
  'f665f927-3d9e-4ab0-a1ba-103d77068d05' => 'Testing 10/13 09:00 T3',
  'd2751ee2-d98d-49df-b9ab-a9120bd28ca6' => 'Testing 10/13 09:00 T4',
  '1f97b3e4-3b7e-47d4-b7d2-5fb621dd8bc8' => 'Testing 10/13 09:30 F5',
  '51e83374-f9c3-4228-93a0-a013c3d54511' => 'Testing 10/13 09:30 FF',
  '26cca5af-3a21-42c5-955f-2a2e320848bd' => 'Testing 10/13 09:30 FV',
  'b66beb2f-59a0-4eea-85e4-5e47d7215a62' => 'Testing 10/13 09:30 SRF3',
  'd853073c-5fb2-4c18-8b35-d6fdcb7324d8' => 'Testing 10/13 10:00 FA',
  '9e229437-2039-4778-922b-112a82735045' => 'Testing 10/13 10:00 FB',
  '9ad4b058-3f50-4360-b22c-c5334da63e34' => 'Testing 10/13 10:00 FC',
  '25cd77a1-7157-4937-9af3-cb40c322ac6c' => 'Testing 10/13 10:00 FE',
  'f49468d2-115b-4bc3-9ff3-baf5dfe4f72e' => 'Testing 10/13 10:00 FE2',
  '12abef9c-446d-42aa-96c4-bfbec03fc977' => 'Testing 10/13 10:00 FM',
  'dae180ab-489f-434c-a69a-6f4c5e44a6d4' => 'Testing 10/13 10:00 P1',
  'a5f78ba5-01e0-4891-bad5-d46770ce44b5' => 'Testing 10/13 10:00 P2',
  '86d6e61b-a78c-4e92-b2ae-aae7f24aa884' => 'Testing 10/13 10:30 AS',
  '164bb9f9-6976-41f8-867a-c5e461d6171b' => 'Testing 10/13 10:30 GT1',
  'f75777b5-8d56-42e5-ba2b-3c9e34b21270' => 'Testing 10/13 10:30 GT2',
  'b46f8721-7800-4649-ad3b-edf5b9bd7464' => 'Testing 10/13 10:30 GT3',
  'eae79b5b-f369-4494-ae6d-249dcc6c0a7a' => 'Testing 10/13 10:30 STU',
  '91df2939-9e31-4ff3-bf3a-bc5e2de976db' => 'Testing 10/13 10:30 T1',
  'a128bda3-68df-4821-a2c3-7823b503ca13' => 'Testing 10/13 10:30 T2',
  'f159f817-514f-43cd-9aa4-b169402445e1' => 'Testing 10/13 11:00 B-Spec',
  'c0210fe9-d39b-485a-b098-b3a51e3e912a' => 'Testing 10/13 11:00 EP',
  '340fd5bc-643e-42ad-a5b6-e02274965ac6' => 'Testing 10/13 11:00 FP',
  '89bfe8b9-ccfe-45ce-adcc-675686cb8c4e' => 'Testing 10/13 11:00 GTL',
  'eef35ee2-b338-470e-b73c-84e206520ef4' => 'Testing 10/13 11:00 HP',
  '84d69803-caff-476d-a280-172df8c2dac3' => 'Testing 10/13 11:00 SM',
  '2e285940-4999-4faa-9d37-fe8aaddbdd89' => 'Testing 10/13 11:00 STL',
  '73bae2a1-0847-4e5f-be1c-d583925af52a' => 'Testing 10/13 11:00 T3',
  '2d9ca870-4fa8-4efb-b910-f3c487dcd8f5' => 'Testing 10/13 11:00 T4',
  '9c1204d3-0717-40f8-807a-899ca8eb7ad1' => 'Testing 10/13 11:30 F5',
  '5fb06fb5-d7d2-4550-b35f-826343ba15b0' => 'Testing 10/13 11:30 FF',
  '87c2e651-0c2d-45ab-a5fd-3cc19f6edc80' => 'Testing 10/13 11:30 FV',
  '24d4581c-d70d-4a19-8f78-d7f6ddcfa8d4' => 'Testing 10/13 11:30 SRF3',
  '587171bf-7e0b-4d4e-bbaa-e6505ac5301c' => 'Testing 10/13 12:00 FA',
  '18db5cf7-a3b6-4f7e-a69a-4faed9c6713a' => 'Testing 10/13 12:00 FB',
  '91de9a2a-e80d-474f-b33e-19ef1ca6ea2d' => 'Testing 10/13 12:00 FC',
  '5e43f72b-e692-4ed9-81fd-d34df24851f0' => 'Testing 10/13 12:00 FE',
  '4ae99d53-0978-414e-bd7b-60016cca4ef2' => 'Testing 10/13 12:00 FE2',
  'aae55023-0c11-44f0-8059-edf938e08050' => 'Testing 10/13 12:00 FM',
  'e7a52dcc-06cc-46be-bb41-2fd30fdd8ec1' => 'Testing 10/13 12:00 P1',
  'c119be9b-69b6-48fa-a785-239461bfb25e' => 'Testing 10/13 12:00 P2',
  'a0175722-61a7-4e4f-b8b2-1c437a449370' => 'Testing 10/13 13:25 AS',
  'dfac3e88-3a7e-40a1-9c9b-cf312c8f847b' => 'Testing 10/13 13:25 GT1',
  '2e30c881-2175-4df8-86fd-00f38fc16b53' => 'Testing 10/13 13:25 GT2',
  'e1c5531d-15fc-4525-b6e9-f48631c36deb' => 'Testing 10/13 13:25 GT3',
  'a7bd28b5-0b8c-40c1-8337-15d9a1a214df' => 'Testing 10/13 13:25 STU',
  'b74f4e3d-2b88-412a-8763-eaeff4713cb4' => 'Testing 10/13 13:25 T1',
  '017b9056-0631-4d64-a8c9-2824e61b416f' => 'Testing 10/13 13:25 T2',
  '8f77bd29-7cb1-49c4-aafb-b0d1c6987681' => 'Testing 10/13 13:55 B-Spec',
  '801051d1-f12b-4194-a97a-5d295452a9ab' => 'Testing 10/13 13:55 EP',
  '843ccd25-cee4-46af-9aad-8b55f6f61bcb' => 'Testing 10/13 13:55 FP',
  '3ea066d5-3409-4d62-9b58-edd028bd2c46' => 'Testing 10/13 13:55 GTL',
  '1ae9d72c-fe32-4af9-936a-e90dcbda6d76' => 'Testing 10/13 13:55 HP',
  '2fbc70f1-96ae-4be5-b35b-53a1d68a76a7' => 'Testing 10/13 13:55 SM',
  '10cfe92e-0ae6-4b05-baab-00895514d4aa' => 'Testing 10/13 13:55 STL',
  '7bef9fa9-c9dc-492f-bb25-7be328a7676b' => 'Testing 10/13 13:55 T3',
  '68ecf14b-d954-4ee4-996d-ece6a39003f3' => 'Testing 10/13 13:55 T4',
  '5e54b17e-4811-4b75-b4d8-7ed6cb3de208' => 'Testing 10/13 14:25 F5',
  'd508c6a6-705b-4ba9-bb81-bd315b26a6bf' => 'Testing 10/13 14:25 FF',
  '0d13a68e-6cd2-4e25-8b5c-e207cfbfdd5a' => 'Testing 10/13 14:25 FV',
  'd786cca7-ff25-4df6-9333-5dd2bea153e5' => 'Testing 10/13 14:25 SRF3',
  'fb1c80f7-8d70-48cb-8b6d-d0f2717f2059' => 'Testing 10/13 14:55 FA',
  '4765dabf-6494-461b-9ef2-1f52ae110a3d' => 'Testing 10/13 14:55 FB',
  '42b11a37-c837-49a4-8166-f23a8e5e81d6' => 'Testing 10/13 14:55 FC',
  '10e6a9b5-9061-4de0-bc57-f8a2da02b9bd' => 'Testing 10/13 14:55 FE',
  '87ff094f-bf14-4d72-9cf0-2d9b1835d580' => 'Testing 10/13 14:55 FE2',
  '2f4de9f0-4786-4f9c-81d0-372abb81cc7d' => 'Testing 10/13 14:55 FM',
  '4a22e603-d886-445e-8e26-21e690255bb1' => 'Testing 10/13 14:55 P1',
  '5f5d25c2-a1b0-4c1f-987d-8fb89f3828a0' => 'Testing 10/13 14:55 P2',
  '90b57e84-8bf9-4b23-990b-89e9e82ea31c' => 'Testing 10/13 15:25 AS',
  'ed365eac-f47f-4277-a5db-129f9c04c6fa' => 'Testing 10/13 15:25 GT1',
  '53c13cd4-c667-4baf-aeb2-a84cba892463' => 'Testing 10/13 15:25 GT2',
  'f7c64e6d-8c58-43ef-acf8-955c697427a2' => 'Testing 10/13 15:25 GT3',
  'd1b43d41-fc52-4338-9ddb-55628208fee4' => 'Testing 10/13 15:25 STU',
  'b11618b7-a478-405c-9920-16eeff9669a8' => 'Testing 10/13 15:25 T1',
  '43085c94-b348-495f-b124-6937b903b23c' => 'Testing 10/13 15:25 T2',
  'e58b993a-ac80-4ed5-8857-827271fdce9b' => 'Testing 10/13 15:55 B-Spec',
  '7c935ffc-a285-4704-b0b4-635132b3463b' => 'Testing 10/13 15:55 EP',
  '4c29f7c4-fe5c-46f0-b376-7df07b528e60' => 'Testing 10/13 15:55 FP',
  '6d1652a9-99a5-420f-a10c-d89882bf9d4d' => 'Testing 10/13 15:55 GTL',
  '30349d8e-1362-4ae0-8811-b0e3d60440d2' => 'Testing 10/13 15:55 HP',
  '00154e72-f279-499f-8932-9a75bf4a90f6' => 'Testing 10/13 15:55 SM',
  'a423732b-f397-4cd1-9133-b0288d119058' => 'Testing 10/13 15:55 STL',
  'b3c5e6a9-e883-4de5-858c-aeb79a9f4699' => 'Testing 10/13 15:55 T3',
  '596d782d-b3e4-4842-a0cf-0353d9b17a37' => 'Testing 10/13 15:55 T4',
  '95e300a2-fb6a-4c72-b368-9ffb41ff446b' => 'Testing 10/13 16:25 F5',
  'a7d05438-ccad-49cc-9678-46f9691a5e85' => 'Testing 10/13 16:25 FF',
  'e8854b55-63e3-4195-8f5f-834932a0f1bf' => 'Testing 10/13 16:25 FV',
  'f8e4aac9-5025-48de-868d-c4c378ac7f5b' => 'Testing 10/13 16:25 SRF3',
  '5eeaf1eb-7295-4b26-87be-658cca1cffe3' => 'Testing 10/13 16:55 FA',
  'f8b0f308-cb76-49a9-9c20-43383d00971c' => 'Testing 10/13 16:55 FB',
  '50d0588b-1dc5-4b1c-ab10-6b9d43592c57' => 'Testing 10/13 16:55 FC',
  'ea0f5118-4891-4820-8af7-6bc7a3baf535' => 'Testing 10/13 16:55 FE',
  'a180eeb9-6ea9-4475-8478-8c11a45e66b2' => 'Testing 10/13 16:55 FE2',
  '5b7f6984-d1dc-4fbb-9ef5-b88d054bab98' => 'Testing 10/13 16:55 FM',
  '25acb04a-71d0-4f2d-913f-e273bee93214' => 'Testing 10/13 16:55 P1',
  'f662a46b-cf60-48bb-ab85-d2bdc98c5f3b' => 'Testing 10/13 16:55 P2',
  '895b393d-b141-4281-81dd-66abeb5c256c' => 'Testing 10/14 08:30 AS',
  '3e9eee03-4b70-420f-9147-b60d3b3cec5b' => 'Testing 10/14 08:30 GT1',
  '5b9ca739-2a33-4485-8acb-262aaefb647c' => 'Testing 10/14 08:30 GT2',
  'ea63021c-46d0-4068-93c5-ae50a430496d' => 'Testing 10/14 08:30 GT3',
  'c318189b-f274-4be6-9a2f-ec00960d6ecc' => 'Testing 10/14 08:30 STU',
  'e2ef86cf-d41e-475e-890c-cf9deff08cbb' => 'Testing 10/14 08:30 T1',
  'a12e85fe-bac0-472e-bf88-7361362b2ff3' => 'Testing 10/14 08:30 T2',
  'a62b6cad-95f0-4f01-83ae-71f72d8a5042' => 'Testing 10/14 08:55 EP',
  '3804dea0-5f19-40ef-bc14-2a8e6b82f90f' => 'Testing 10/14 08:55 FP',
  '20ad1914-8a5a-46c3-8e81-1c1faa72a77e' => 'Testing 10/14 08:55 GTL',
  '34cee4de-2ead-456c-8742-c6b94fdbb2bf' => 'Testing 10/14 08:55 HP',
  '46229fdb-09e9-45c0-94a6-409fe9332456' => 'Testing 10/14 08:55 STL',
  '82974305-a9ae-44b7-81f0-7482d1b3ba4b' => 'Testing 10/14 09:20 F5',
  '4bca8527-bda7-4ea5-810f-bf8986d9ca62' => 'Testing 10/14 09:20 FF',
  'b6ff5091-3b12-4c8c-a058-20d95c731e90' => 'Testing 10/14 09:20 FV',
  '2379ebc1-24ea-4dc4-be72-a29eeeed1ace' => 'Testing 10/14 09:20 SRF3',
  'f64b18f8-fa3f-4d0c-9d76-53763db7fe09' => 'Testing 10/14 09:45 FA',
  '09ca3a36-2c77-486e-8196-3b92c1df19c0' => 'Testing 10/14 09:45 FB',
  '84757aa4-0ce6-4424-8cda-034d2334f12f' => 'Testing 10/14 09:45 FC',
  '1d2f3224-7154-4af7-b99f-3a16aeba0c9f' => 'Testing 10/14 09:45 FE',
  'c0f0e815-878a-4543-a9b0-a2eaf5a26f71' => 'Testing 10/14 09:45 FE2',
  '1df7537f-cc20-4856-892d-f9813d85df03' => 'Testing 10/14 09:45 FM',
  'be464667-47ca-4726-a175-2e5ee64498e0' => 'Testing 10/14 09:45 P1',
  'cc5aa3c4-5571-4465-adf3-121e58d1928b' => 'Testing 10/14 09:45 P2',
  '14c4ee3a-1d2c-4876-9bfe-c39bc94a2a0b' => 'Testing 10/14 10:10 B-Spec',
  'ecad95ba-c882-46fd-813e-3f76bec45a12' => 'Testing 10/14 10:10 SM',
  '1557a2a8-0ca1-4129-8ac0-334eb11e8ccf' => 'Testing 10/14 10:10 T3',
  '8f7f09e7-082e-4af5-bd5b-45ccab0909bf' => 'Testing 10/14 10:10 T4',
  '5854992b-0cb9-44f1-b1f2-64f4e16f407a' => 'Testing 10/14 10:35 AS',
  'c6095a5b-4807-4ed9-8b57-c038d9eadb48' => 'Testing 10/14 10:35 GT1',
  'cae3b43c-8ba2-4ee0-a63d-0d5327563de3' => 'Testing 10/14 10:35 GT2',
  'ca907fa7-346e-4522-b54d-196a702f3dc3' => 'Testing 10/14 10:35 GT3',
  'c5b3ae2f-f7ec-4d63-aa48-94503a29775a' => 'Testing 10/14 10:35 STU',
  '3bf20135-9a43-4332-b3be-dafdb452269d' => 'Testing 10/14 10:35 T1',
  '410e1c68-81c5-4f4e-9472-c6709da1337d' => 'Testing 10/14 10:35 T2',
  '30112ab8-d196-4f0b-ae35-73c6e158a78e' => 'Testing 10/14 11:00 EP',
  'f2ee4d86-7e71-43b7-abb7-18f652d31685' => 'Testing 10/14 11:00 FP',
  '15bd82c0-1f79-4178-81bc-ad65ef9ffa75' => 'Testing 10/14 11:00 GTL',
  '27e30789-d18a-4692-a27d-c3a97a2bae48' => 'Testing 10/14 11:00 HP',
  '593d51b9-dced-4eef-b1b1-252d6bd66a6c' => 'Testing 10/14 11:00 STL',
  'baf60a2c-aab9-4e45-b257-26bfa38876c5' => 'Testing 10/14 11:25 F5',
  '07a49a52-13f6-4cba-8d10-f36129c40a11' => 'Testing 10/14 11:25 FF',
  '8d2d7be4-222b-422f-9f96-2b96021924c1' => 'Testing 10/14 11:25 FV',
  'd3c5ab57-9655-48b7-8aaf-42e05edbe1da' => 'Testing 10/14 11:25 SRF3',
  '379bca10-4425-4b7b-8b64-29e4feb85e75' => 'Testing 10/14 11:50 FA',
  '827c6236-10a0-4441-897e-eefa6b102321' => 'Testing 10/14 11:50 FB',
  'e37cd757-32db-4624-bac1-0a86a854f3b6' => 'Testing 10/14 11:50 FC',
  'f892e092-fb96-4104-9cfe-388ea2ec1513' => 'Testing 10/14 11:50 FE',
  'b9deb7e5-accb-48b7-b145-465f67e39e0d' => 'Testing 10/14 11:50 FE2',
  '13a4a23b-b767-4b34-8dc2-55ccffc39fe8' => 'Testing 10/14 11:50 FM',
  '17424c6a-d406-4932-8b81-ca94fdb78325' => 'Testing 10/14 11:50 P1',
  '818db87a-5791-4706-b9e3-1209e615ed1d' => 'Testing 10/14 11:50 P2',
  '74941715-e4cf-49a3-b855-9a4d0eb174a3' => 'Testing 10/14 12:15 B-Spec',
  '290934b7-fcb3-4936-ace2-741b80d12edf' => 'Testing 10/14 12:15 SM',
  'f08c0078-e8c4-4cdc-b4c8-6b52974a4ca9' => 'Testing 10/14 12:15 T3',
  '538cd7d3-d0e6-4b78-a908-c693e4b79a7c' => 'Testing 10/14 12:15 T4',
  'f0aac7bd-3301-4c2b-8708-62d81c6a3c7e' => 'Testing 10/14 13:35 AS',
  '2e144fab-cc4c-43ab-a4b6-b6d05bbcfd47' => 'Testing 10/14 13:35 GT1',
  '19cd0623-7d0c-4973-8aa0-085a46b7715a' => 'Testing 10/14 13:35 GT2',
  '5efb8ac8-383a-48e6-afa9-46df8bf76d8d' => 'Testing 10/14 13:35 GT3',
  '26764d46-2f81-4d30-8c36-ce96774d5e67' => 'Testing 10/14 13:35 STU',
  '6481b3bd-b40d-49d9-828d-bf5207720ab5' => 'Testing 10/14 13:35 T1',
  'f6b0b817-eb70-4545-a1a6-1497504c4b0b' => 'Testing 10/14 13:35 T2',
  '6093d1ea-84d2-4297-8fb6-cc54be754556' => 'Testing 10/14 14:00 EP',
  '4bccd16f-de61-40ee-b5f6-b8a307aaa10e' => 'Testing 10/14 14:00 FP',
  '12334b39-18b5-4e18-ba4a-d0fcbc040290' => 'Testing 10/14 14:00 GTL',
  '0203191b-acb0-4655-80eb-38b84f0ed5c2' => 'Testing 10/14 14:00 HP',
  '68094bbb-dacd-4698-a9b1-92ba8e4c863b' => 'Testing 10/14 14:00 STL',
  'e59469ee-fe24-423f-a16a-803883f95cd1' => 'Testing 10/14 14:25 F5',
  '52a49072-42e5-4c1c-a2cb-f40bd21e464d' => 'Testing 10/14 14:25 FF',
  'e2619ba2-3185-4e8b-9a7c-7617d472d808' => 'Testing 10/14 14:25 FV',
  'd7715a16-c26c-4fac-9a1b-fe2f6c9fe780' => 'Testing 10/14 14:25 SRF3',
  '43014b72-e778-4bdd-bfa2-c91d78a8bf34' => 'Testing 10/14 14:50 FA',
  '32ebde05-b259-441b-9595-cc9b1d26eb02' => 'Testing 10/14 14:50 FB',
  '5568a995-391f-4cc0-9d09-4a30c47c08fa' => 'Testing 10/14 14:50 FC',
  'a5b417d6-d70d-41ad-a496-58977a7215fb' => 'Testing 10/14 14:50 FE',
  '81210544-22b1-42bf-b6c1-5275325b3fec' => 'Testing 10/14 14:50 FE2',
  'b50901e2-83f8-467a-b011-99ee8217c1ee' => 'Testing 10/14 14:50 FM',
  'ba2ab08a-9d4a-4aef-ab82-7b05e6f3e0cb' => 'Testing 10/14 14:50 P1',
  '9f74633e-3233-4277-95ea-d0f73d8c37aa' => 'Testing 10/14 14:50 P2',
  '87bf2f07-f5a3-4ac5-ac97-e1ed4f4f91d4' => 'Testing 10/14 15:15 B-Spec',
  '6262c7a0-0084-4749-805c-c345b5b6f884' => 'Testing 10/14 15:15 SM',
  'a4bb5f4f-456b-4a99-badc-12a7a3eb2d2a' => 'Testing 10/14 15:15 T3',
  '127d7396-c526-4b60-be6b-b8078b4fe472' => 'Testing 10/14 15:15 T4',
  'd2730f8a-57b1-4c99-9ff6-70d55712bb09' => 'Testing 10/14 15:40 AS',
  '57163838-1cf0-4004-80bb-2744e176c4ef' => 'Testing 10/14 15:40 GT1',
  '5d4c78dd-897a-4512-8ba1-ed93457f2b6d' => 'Testing 10/14 15:40 GT2',
  'a6c8d556-5f79-4eec-a861-01884a695c4e' => 'Testing 10/14 15:40 GT3',
  'e0afac05-8f7d-420c-9edc-7c888f1a3b52' => 'Testing 10/14 15:40 STU',
  '661b9723-024f-440a-b133-6f0c8277d814' => 'Testing 10/14 15:40 T1',
  '4e60cd13-b519-4e1d-95b3-c4ae10bbeb86' => 'Testing 10/14 15:40 T2',
  'da360e2b-fbb8-434f-9bd2-8b458b24aab5' => 'Testing 10/14 16:05 EP',
  '20a3466d-8352-40c6-a46c-c1b21a988087' => 'Testing 10/14 16:05 FP',
  '97716066-623f-453f-8ec7-070369f35c3e' => 'Testing 10/14 16:05 GTL',
  '55b09c09-177a-4dfd-acb5-502aec4f251a' => 'Testing 10/14 16:05 HP',
  '6663b62d-7927-4db6-92f3-fdf199b6f6aa' => 'Testing 10/14 16:05 STL',
  '2aecbada-b512-451a-92d6-1f512cfe8d41' => 'Testing 10/14 16:30 F5',
  '98cbd53f-1447-4e24-9381-6fbadd3175ce' => 'Testing 10/14 16:30 FF',
  '70de2163-faea-44e8-8a02-aa36ef420573' => 'Testing 10/14 16:30 FV',
  '74517f88-6dd1-41bf-b908-ec5460246f5d' => 'Testing 10/14 16:30 SRF3',
  '47cf0b1c-ee23-4b09-ae8e-f42e821b3c99' => 'Testing 10/14 16:55 FA',
  'ed3f953c-ae82-4885-912b-0eea6a00df9f' => 'Testing 10/14 16:55 FB',
  '80ff5d59-f4bd-4197-9619-bc29ca146fab' => 'Testing 10/14 16:55 FC',
  '3841087a-df8f-40ee-aec4-158b68ae8fe8' => 'Testing 10/14 16:55 FE',
  'd34d01a2-9778-44e0-82d4-b829cb4e465f' => 'Testing 10/14 16:55 FE2',
  '8e5555e9-87d7-4035-ac38-bf86602b3e00' => 'Testing 10/14 16:55 FM',
  '8d653d11-9979-48c2-8252-1b6725d6bcad' => 'Testing 10/14 16:55 P1',
  '44571547-4964-4bc2-a22b-b34e257902ee' => 'Testing 10/14 16:55 P2',
  '395e8761-bdb1-4c80-a29e-949dfa2d7eec' => 'Testing 10/14 17:20 B-Spec',
  'ef22fff6-3ae9-4437-8fe4-a4a45826b097' => 'Testing 10/14 17:20 SM',
  '33afdb77-65f7-4765-adcc-7c190d737899' => 'Testing 10/14 17:20 T3',
  '6c406286-92c7-4baf-acc0-9fbb1b01b92f' => 'Testing 10/14 17:20 T4',
  'd9e154cc-ec22-4ea5-ba46-9a8d1c6e2965' => 'Testing 10/15 08:30 AS',
  '8b95f91c-2edf-4378-a0c9-3d7d38f7bf30' => 'Testing 10/15 08:30 GT1',
  'e84e6596-4c01-4310-89ab-cc30b230a3b1' => 'Testing 10/15 08:30 GT2',
  'af941d2d-e64b-40ec-94e8-a6c48e3c2ced' => 'Testing 10/15 08:30 GT3',
  'fec3f839-f5dc-4faa-bd3e-7adf23684001' => 'Testing 10/15 08:30 STU',
  '418cdacb-a07c-4bc5-b48f-a2299b2a7d6a' => 'Testing 10/15 08:30 T1',
  '339eee04-e6b9-4bd1-af22-e56faaa2c6c8' => 'Testing 10/15 08:55 B-Spec',
  '87febab9-2582-4683-8328-0b6cd34cc56b' => 'Testing 10/15 08:55 EP',
  '6ff2cf18-1d4d-430f-a103-fb617431505d' => 'Testing 10/15 08:55 FP',
  '6d361e4f-abc8-4a66-8f90-1269e225c795' => 'Testing 10/15 08:55 GTL',
  '4cb3e499-c31f-4e32-8fe6-48405d85f0d8' => 'Testing 10/15 08:55 HP',
  '80f7cd2f-2bbf-4e69-a97f-4a2642b38dea' => 'Testing 10/15 09:20 F5',
  '2a50ac40-94af-484d-8ebc-c9f647081ada' => 'Testing 10/15 09:20 FF',
  'aa4f756c-dfd9-4a56-b485-f13435c7dbf1' => 'Testing 10/15 09:20 FV',
  'dd7fb2b3-50f1-40f4-be1d-e08a92da281d' => 'Testing 10/15 09:45 FA',
  '052060f3-8cf8-42e1-94a9-ff4ec1a02636' => 'Testing 10/15 09:45 FB',
  '8d157d96-4058-4cb3-b8f8-37aa8ebe7a11' => 'Testing 10/15 09:45 FC',
  '67acdd01-8959-438e-be05-abd92f77095c' => 'Testing 10/15 09:45 FE',
  '473a0094-0297-46bc-985f-fb53f5fc539e' => 'Testing 10/15 09:45 FE2',
  '18422f2f-f8ed-49db-8296-26ff7557060a' => 'Testing 10/15 09:45 FM',
  '1d0cd97e-ef70-4a49-a107-4ac4ae43b6d9' => 'Testing 10/15 09:45 P1',
  '7c123f40-bf32-491f-9f5d-4a400fdd9af3' => 'Testing 10/15 09:45 P2',
  '52d27b03-fc23-4f47-93c0-c6ef914c8d9f' => 'Testing 10/15 10:10 SM',
  'bdbc7e4b-7956-4fbc-a4ab-22ef1772b1a3' => 'Testing 10/15 10:10 STL',
  '2e385be7-2921-46d3-bce1-3f403f7d8f6f' => 'Testing 10/15 10:35 SRF3',
  '4a894c4c-b2b6-4e9e-b270-8504aca12106' => 'Testing 10/15 11:00 T2',
  'bef0a59b-c0d6-4c9e-9123-02cd8462fe87' => 'Testing 10/15 11:00 T3',
  '34c4ba08-56ce-47d0-8f39-0e7d545a8fdb' => 'Testing 10/15 11:00 T4',
  '95f4ac80-f969-4b61-8e0d-cbab7f25df93' => 'Testing 10/15 11:25 AS',
  '317688c9-62c6-4fc6-9ead-0f51d067d889' => 'Testing 10/15 11:25 GT1',
  'e96d8cf5-5132-4d46-822d-e14400bc892f' => 'Testing 10/15 11:25 GT2',
  '54ee0556-63c8-4ea1-aa91-662255a5c800' => 'Testing 10/15 11:25 GT3',
  'fa1b54ab-f3e8-4341-b60a-091612302088' => 'Testing 10/15 11:25 STU',
  '5ec3de65-f71a-46c7-a5aa-4db1dc994139' => 'Testing 10/15 11:25 T1',
  '16058f02-85e7-4adf-81be-925dcf365d3f' => 'Testing 10/15 11:50 B-Spec',
  '70e7285b-b765-4a8b-a81c-f1e6bb4f1a9a' => 'Testing 10/15 11:50 EP',
  '48982b5f-3c51-400e-8d92-10581c7f4f13' => 'Testing 10/15 11:50 FP',
  '482c6209-e35a-4b89-9f6e-c76e0746dba7' => 'Testing 10/15 11:50 GTL',
  '90d11cf7-dbeb-4a89-bf2c-0f194409fc25' => 'Testing 10/15 11:50 HP',
  'b4d47580-6598-4803-9cff-035c79444a41' => 'Testing 10/15 12:15 F5',
  '87859804-339c-4489-b4ab-6906fbc612e6' => 'Testing 10/15 12:15 FF',
  '159b3819-b9a4-40ca-9e84-0840487c5ec0' => 'Testing 10/15 12:15 FV',
  '4424003a-51c1-4807-abfe-c5132fa15b32' => 'Testing 10/15 13:35 FA',
  '4b2b949c-e89d-427e-8476-f59788573735' => 'Testing 10/15 13:35 FB',
  '9720722f-71dd-4bad-afee-41eced593e2d' => 'Testing 10/15 13:35 FC',
  'a28c61ed-a82a-427a-a4e2-df586a6e530c' => 'Testing 10/15 13:35 FE',
  '8d3a4e3e-cd4e-46a3-9c84-b269e6983632' => 'Testing 10/15 13:35 FE2',
  '5eb39a15-150c-4552-8dbb-e0f079909064' => 'Testing 10/15 13:35 FM',
  'e2c694ad-77a1-444d-aadc-e56d38334738' => 'Testing 10/15 13:35 P1',
  '5203ee94-9961-4ce7-8535-f125595d41ce' => 'Testing 10/15 13:35 P2',
  '867c6a42-32c1-4ef4-8680-f9fe65dd3e60' => 'Testing 10/15 14:00 SM',
  'bf728f36-e518-45ec-933b-34c4ee9d7589' => 'Testing 10/15 14:00 STL',
  '6a443d4e-1c89-4544-87a9-02ad84dc6abe' => 'Testing 10/15 14:25 SRF3',
  'a79801e5-064f-442f-a171-399d9de48183' => 'Testing 10/15 14:50 T2',
  '767a98c9-697e-4433-8d66-817abc45ccf8' => 'Testing 10/15 14:50 T3',
  'd45562a7-7cb6-4729-92f0-51a50ffb84de' => 'Testing 10/15 14:50 T4',
  '8df7b380-3a03-46e0-a777-c049849f11d2' => 'Testing 10/15 15:15 AS',
  '85a4d8dd-fed7-4b1b-9bbf-58c4cfbc3920' => 'Testing 10/15 15:15 GT1',
  '0f2fd20e-845a-4fa9-9202-de89f033fe9f' => 'Testing 10/15 15:15 GT2',
  'ab493bfb-ab4d-4116-89b9-2f4180e7a4bc' => 'Testing 10/15 15:15 GT3',
  'f4fca670-c568-4d5a-a537-0c5d37f8361c' => 'Testing 10/15 15:15 STU',
  'b5c6ea0d-c7e4-4db6-8a03-857632608b97' => 'Testing 10/15 15:15 T1',
  '7c8af362-37c5-49f6-ae4d-687733c41ca6' => 'Testing 10/15 15:40 B-Spec',
  '71cd0ebe-0cf7-496c-8fe8-297a7223fd12' => 'Testing 10/15 15:40 EP',
  '8b404d1b-98d9-469a-a21c-9911f2ea1f5d' => 'Testing 10/15 15:40 FP',
  'e78f6531-fce2-43df-bf95-54015ddd84bc' => 'Testing 10/15 15:40 GTL',
  '2e64ff34-0a89-43dd-9cbc-b8dcba3cc620' => 'Testing 10/15 15:40 HP',
  '97085be1-c351-4c8b-b252-e961b4e4b802' => 'Testing 10/15 16:05 F5',
  '19b7441e-be25-41a3-b039-89d4a554477d' => 'Testing 10/15 16:05 FF',
  'd629dbc6-fd2e-4efa-bf65-2304185ab554' => 'Testing 10/15 16:05 FV',
  '1c379094-aa27-4460-ab89-a1500af8ecb3' => 'Testing 10/15 16:30 FA',
  'ce5ba0f2-3d77-43d0-9777-39e559e5ffa6' => 'Testing 10/15 16:30 FB',
  '818631cc-4dbd-48f7-ae0e-c87f03b936ec' => 'Testing 10/15 16:30 FC',
  'fe1399f8-d4e2-4527-a6ca-97cbe6544fd6' => 'Testing 10/15 16:30 FE',
  'c1a0ed28-31fb-4145-b7df-4f8e61f037fe' => 'Testing 10/15 16:30 FE2',
  '8f1554b7-7df2-48fd-b54e-e22c415d66f0' => 'Testing 10/15 16:30 FM',
  '824c187d-17c6-4c6f-a530-b010f8eee761' => 'Testing 10/15 16:30 P1',
  'e19ed42e-1468-4e21-b9f4-4d8d489a1bac' => 'Testing 10/15 16:30 P2',
  '5b79cdb0-d07e-4e5f-9f5f-d8da06f44948' => 'Testing 10/15 16:55 SM',
  '8b846631-4aec-426d-bb1a-331971f68d1d' => 'Testing 10/15 16:55 STL',
  '1f87808e-4c4e-4fc0-b846-faf576855567' => 'Testing 10/15 17:20 SRF3',
  'fb9cd30a-2e79-48d8-a868-5e2812274edf' => 'Testing 10/15 17:45 T2',
  '8bc94165-2db2-4839-8bfa-2e2f7c623a78' => 'Testing 10/15 17:45 T3',
  '226e5df5-f278-48f2-882f-f640253d87a6' => 'Testing 10/15 17:45 T4',
  '28f5dd1d-a5c1-4f23-9db8-c5add6b89f99' => 'Qualifying 10/16 08:30 STU',
  '06562455-7163-43dc-be98-62617f64b31b' => 'Qualifying 10/16 08:30 T3',
  '15ed79cd-c8df-4d8b-a2ed-e4c189f55041' => 'Qualifying 10/16 08:57 GT1',
  '523a6e12-ab1b-438a-8071-1de4b6ea2d00' => 'Qualifying 10/16 09:24 FC',
  '9de629b5-b4b8-460f-b34a-7d88571f2415' => 'Qualifying 10/16 09:51 P1',
  '45501fbd-fc5a-432d-8700-c8a58eaddbb1' => 'Qualifying 10/16 09:51 P2',
  '2d95f1e6-32c2-47c8-99db-d53b8d0d3554' => 'Qualifying 10/16 10:18 GT2',
  '5d30ce1c-9003-4a36-8632-54b1338dd84d' => 'Qualifying 10/16 10:45 EP',
  'b95a46ed-b780-437c-8c36-1c646b5b7926' => 'Qualifying 10/16 10:45 GTL',
  'ecca47a0-6c23-4948-8d99-c2644a3ad6e1' => 'Qualifying 10/16 11:12 FV',
  '525bf1b7-c5f1-4738-8e8d-b1b1835594ef' => 'Qualifying 10/16 11:39 STL',
  '8ba93922-eefc-44c8-9125-ee254d1abf1d' => 'Qualifying 10/16 12:06 F5',
  '1e53903d-a247-4d0e-9336-a633d06ceab7' => 'Qualifying 10/16 12:06 FF',
  '7641935f-4dfb-425b-98ba-17e70bf9c222' => 'Qualifying 10/16 13:30 SRF3',
  '1e71bb7b-2d22-43e7-a3a3-8d0a3c62ff2e' => 'Qualifying 10/16 13:57 SM',
  'd741bb23-d8d1-461b-88c2-48edf871abdf' => 'Qualifying 10/16 14:24 T2',
  '450a6b4e-6e3d-42c2-a0c7-27cfca45717f' => 'Qualifying 10/16 14:51 FP',
  '8e94f9d7-dd3f-4545-9468-feff7fcb18be' => 'Qualifying 10/16 14:51 HP',
  '0dbe426b-5eed-4cac-949c-de6180d293c6' => 'Qualifying 10/16 15:18 AS',
  '74aa4a89-e05a-4bbb-ad56-5659109684af' => 'Qualifying 10/16 15:18 T1',
  '5ae24cac-8c18-4fcf-8af2-336086be6804' => 'Qualifying 10/16 15:45 GT3',
  'd270ec3b-41e7-4e2b-ad16-f51dfce86262' => 'Qualifying 10/16 16:12 FE',
  'b45d529d-c87c-48ed-99e9-5d7cd17912b8' => 'Qualifying 10/16 16:12 FE2',
  'f2b4afe8-bccf-41c3-b758-c82bdbd50d3f' => 'Qualifying 10/16 16:12 FM',
  'e6a6c819-bbcf-4984-adf1-79c821960830' => 'Qualifying 10/16 16:39 B-Spec',
  '1c22767b-9b9b-45f8-9950-16e448ed5ffd' => 'Qualifying 10/16 16:39 T4',
  'ea90a2ee-ec49-405d-8a97-3c6da6597c83' => 'Qualifying 10/16 17:06 FA',
  'a8dbf805-4db2-4bcf-99e8-69d11d0ad0a5' => 'Qualifying 10/16 17:06 FB',
  '6ca5d5e2-eed9-4553-9a30-cb72fa202ca6' => 'Qualifying 10/17 08:30 STU',
  'dd50596c-2b44-44b7-8619-e5a033380c01' => 'Qualifying 10/17 08:30 T3',
  '670fc4fa-3b89-4942-b760-adccabc50443' => 'Qualifying 10/17 08:57 GT1',
  '7ad2a38a-09a6-4af2-8dbd-bc03beb1e476' => 'Qualifying 10/17 09:24 FC',
  '97f167d8-f472-41bc-b340-e97d28b772a1' => 'Qualifying 10/17 09:51 P1',
  '1ee58a21-cbd5-4807-a0b8-6fa7bbd0fba3' => 'Qualifying 10/17 09:51 P2',
  '770bf80b-3cea-4df9-a8dc-71e73798d29d' => 'Qualifying 10/17 10:18 GT2',
  'baf160e6-fe23-4e5a-87e4-35358da45506' => 'Qualifying 10/17 10:45 EP',
  '6164c121-2e98-4707-9ec4-4f6278e2732e' => 'Qualifying 10/17 10:45 GTL',
  '71ab3020-bd76-4a69-b9ba-ad552874be7b' => 'Qualifying 10/17 11:12 FV',
  '5e23f1cd-7d06-45ef-bdda-9de2e6d06ed5' => 'Qualifying 10/17 11:39 STL',
  '67ef873c-ef65-48cd-a863-1b11c1e2d0e3' => 'Qualifying 10/17 12:06 F5',
  '11b32c13-789b-489b-86f0-4d4e4385508d' => 'Qualifying 10/17 12:06 FF',
  '05f53fc5-df1b-4dd2-8954-1ccadf5aa448' => 'Qualifying 10/17 13:30 SRF3',
  '9e43e3d5-c1fb-4406-95f7-027d39c4e833' => 'Qualifying 10/17 13:57 SM',
  '39cfb57b-1348-4adc-857b-df7f3be450a0' => 'Qualifying 10/17 14:24 T2',
  'a72e256c-c510-402c-ab08-f67933f82a83' => 'Qualifying 10/17 14:51 FP',
  '74ee9005-b7c5-4317-9d4b-7e5318ba6cfd' => 'Qualifying 10/17 14:51 HP',
  '8085327a-3857-44fb-b47b-28914880895e' => 'Qualifying 10/17 15:18 AS',
  'be75195c-ab09-40c7-8aa0-f7781462cfa7' => 'Qualifying 10/17 15:18 T1',
  '59e767a8-60a7-477b-bbc4-2e06c642dbcf' => 'Qualifying 10/17 15:45 GT3',
  '0563f95c-291c-4112-9525-68ff97a1140a' => 'Qualifying 10/17 16:12 FA',
  '254098f7-b81d-4810-87c7-1691f9265237' => 'Qualifying 10/17 16:12 FB',
  '48e0af8a-248f-4361-b1ed-035fee52da7c' => 'Qualifying 10/17 16:39 B-Spec',
  'f95a2623-f229-4fd8-9cb7-8750ede04640' => 'Qualifying 10/17 16:39 T4',
  'ea44793a-ea41-41a6-9a9d-62c7399d5e88' => 'Qualifying 10/17 17:06 FE',
  'd602ad23-ab84-4bb4-a492-a0dd9545f578' => 'Qualifying 10/17 17:06 FE2',
  'ae111770-7bd0-40a2-b342-bbca8d0d04fc' => 'Qualifying 10/17 17:06 FM',
  '7577e63f-fc76-4f12-9819-c54be401a03a' => 'Qualifying 10/18 08:30 STU',
  '512d86ca-dd0c-48c1-be38-f7923ad522e6' => 'Qualifying 10/18 08:30 T3',
  '7b11e1e6-9447-4a45-a662-141b41753cb7' => 'Qualifying 10/18 08:57 GT1',
  'b5f8cadf-b100-4230-b0fc-dc345758fc5b' => 'Qualifying 10/18 09:24 FC',
  '2c1bad6d-4ed5-4be2-be68-636a1c9b406e' => 'Qualifying 10/18 09:51 P1',
  '5d8325a5-4cc5-4866-86a3-bae3f027709a' => 'Qualifying 10/18 09:51 P2',
  '8f49ef08-521c-4667-beb8-fd64147be145' => 'Qualifying 10/18 10:18 GT2',
  '8396dd2f-3822-476a-9dbb-8440819b14d7' => 'Qualifying 10/18 10:45 EP',
  'da977627-73f1-4c87-be87-a727a05379e0' => 'Qualifying 10/18 10:45 GTL',
  'd48c2df0-6263-4400-996d-a736cac3ad1a' => 'Qualifying 10/18 11:12 FV',
  'abdf4ac2-41d5-42da-9a47-fe0ffbe9a153' => 'Qualifying 10/18 11:39 STL',
  '83103c9d-3afb-4c47-9c52-e13835899594' => 'Qualifying 10/18 12:06 F5',
  '06a67007-6cec-43dc-8fa6-9c3bd5da692b' => 'Qualifying 10/18 12:06 FF',
  'ff995bc8-b375-44a7-b264-4125390e5a13' => 'Qualifying 10/18 13:30 SRF3',
  'eaec62e7-56fa-44be-aeff-69c540b5bc3e' => 'Qualifying 10/18 13:57 SM',
  '81899741-a705-455f-b595-760dda1b0518' => 'Qualifying 10/18 14:24 T2',
  '0b08c66d-28fb-4fe2-a3fc-ac54599c4165' => 'Qualifying 10/18 14:51 FP',
  '138d1b44-29e0-4126-b4a8-6c1ef4bbe5b0' => 'Qualifying 10/18 14:51 HP',
  '43954069-b991-45e1-82b5-9ee43fe09e18' => 'Qualifying 10/18 15:18 AS',
  '7a42b9e7-f48f-4160-826d-768422b3d3e6' => 'Qualifying 10/18 15:18 T1',
  '26d7dcf2-bacb-4d4f-a062-427d4ec4ae5a' => 'Qualifying 10/18 15:45 GT3',
  '6ee6746b-af6f-40ac-9b28-15df0c90f353' => 'Qualifying 10/18 16:12 FE',
  'd4ff8025-38e2-4864-b2cc-6f1029004886' => 'Qualifying 10/18 16:12 FE2',
  'c4eff844-7812-49ef-845f-dc49d4e4e386' => 'Qualifying 10/18 16:12 FM',
  '2989046c-2d5a-4196-86bf-dcdd43a124e2' => 'Qualifying 10/18 16:39 B-Spec',
  '00f0d852-86e1-4d03-92a2-a2dcea7c7090' => 'Qualifying 10/18 16:39 T4',
  'c8bd341b-5443-4b55-a290-8f56e051e920' => 'Qualifying 10/18 17:06 FA',
  'ce79ff4b-a0b0-48e7-ba5d-a52232e6b93e' => 'Qualifying 10/18 17:06 FB',
  '388ecc1b-604b-4c1e-92ea-f1a961437175' => 'Race 10/19 08:30 GT1',
  '45526826-979b-4b09-b5a1-12d084e1d071' => 'Race 10/19 09:35 FC',
  '81c70bdb-a87a-4c90-a1b4-6747fcb50024' => 'Race 10/19 10:40 GTL',
  'c8110e4e-c1d6-4c61-ae1e-9fd71077c3bc' => 'Race 10/19 11:45 FV',
  'e0e81fc0-6a66-47be-870f-dc849d52487c' => 'Race 10/19 13:30 HP',
  '8dab587c-6ee2-4d68-b6d5-22e9e0426165' => 'Race 10/19 14:35 FM',
  '761e9ecd-1497-47fd-9402-15069a6c7c8e' => 'Race 10/19 15:40 AS',
  'aadbac77-96a4-4bb5-ab28-1fe714bda951' => 'Race 10/19 16:45 FE',
  'f1231210-9930-43ff-b21a-70a7756c0e28' => 'Race 10/19 16:45 FE2',
  '603c868e-b2f5-4ede-af17-98d7cf038abf' => 'Race 10/20 08:30 STU',
  '6787035f-075d-4d52-a4ec-52077c470b52' => 'Race 10/20 09:35 P2',
  '2d8c4ff1-4866-4eee-9e3b-1285563f411b' => 'Race 10/20 10:40 GT2',
  'f9463434-b2c8-4e2c-96df-885afc53946a' => 'Race 10/20 11:45 F5',
  '5b98fdc8-6e14-4426-8bee-b2f3f986f1db' => 'Race 10/20 11:45 FF',
  '76ae7432-da5c-46a9-ac3f-52d95edaed8e' => 'Race 10/20 13:30 SM',
  '9b04be61-8b22-4fdf-b45c-17a9dc735e6d' => 'Race 10/20 14:35 T1',
  '8109045b-3f1d-420a-bcfa-55de004191e2' => 'Race 10/20 15:40 FP',
  '523d882c-0927-4f1c-a038-817904e210ae' => 'Race 10/20 16:45 B-Spec',
  '92fe18ad-4750-42fa-805d-b56c96ea1522' => 'Race 10/20 16:45 T4',
  'b1376f97-1f13-4dcf-808f-c80913cdaf78' => 'Race 10/21 08:30 T3',
  '1c740ba0-909e-437a-938a-524e07d93378' => 'Race 10/21 09:35 EP',
  'ca52e249-0200-4490-aa24-07b496579442' => 'Race 10/21 10:40 P1',
  '0597c012-dbfc-4fb1-afda-9d38a996001b' => 'Race 10/21 11:45 STL',
  'fa60a509-1565-4d27-b696-7d0a16acb894' => 'Race 10/21 13:30 SRF3',
  '5adeaf99-6c6e-4e4f-a96a-4987aac5eb02' => 'Race 10/21 14:35 T2',
  '2209ce0f-0426-4f3c-9f1c-fd0715c635a4' => 'Race 10/21 15:40 GT3',
  '85469652-0f70-49db-99b6-d32f360aedfb' => 'Race 10/21 16:45 FA',
  '7d945eb2-0767-49f4-a2f5-1128db0bf9e5' => 'Race 10/21 16:45 FB',
);

sub usage  {
  print STDERR @_, "\n" if @_;
  print <<"EOF";
Usage: actionmon [-dvx] [-H host] [-U user] [-P pass] [-D dbpath] [-p printer]
                 [-rm] [file]
       actionmon [-dvx] [-H host] [-U user] [-P pass] [-D dbpath] [-p printer]
                 [-au] [-f] act_no...
       actionmon -h
  -d  Debug
  -h  This help message
  -x  Fetch data file only
  -v  Verbose action list

  -l  List actions in database
  -a  Show/print specified actions
  -r  Print a summary report
  -m  Continually monitor the action system
  -u  Update specified actions...
      with -x, fetch action detail file(s) only
      with -f, force replace/reprint of existing action

  -H  action system server host
  -U  action system userid
  -P  action system password
  -D  database file [$DBPath]
  -p  Print to specified printer

EOF
  exit !!@_;
}

sub parse_args () {
  my %opts;

  getopts('adfhlmruvxp:D:H:U:P:', \%opts) or usage("Invalid option!");
  usage()    if $opts{h};
  $DEBUG++   if $opts{d};
  $VERBOSE++ if $opts{v};
  $GETONLY++ if $opts{x};
  $REPORT++  if $opts{r};
  $MONITOR++ if $opts{m};
  $UPDATE++  if $opts{u};
  $LIST++    if $opts{l};
  $LIST = 2  if $opts{a};
  $FORCE++   if $opts{f};

  $DBPath   = $opts{D} if defined $opts{D};
  $Printer  = $opts{p} if defined $opts{p};
  $SERVER   = $opts{H} if defined $opts{H};
  $USERID   = $opts{U} if defined $opts{U};
  $PASSWD   = $opts{P} if defined $opts{P};

  $URLBase  = "http://$SERVER/racecontrol/";
  $LoginURL = $URLBase . 'Login.aspx';
  $ListURL  = $URLBase . 'Actions.aspx';
  $GetURL   = $URLBase . 'GetAction.aspx?ActionNum=';

  my $pwpath = "$ENV{HOME}/.runoffs_pw";
  if (!$PASSWD && -f $pwpath) {
    my $F = new IO::File($pwpath, O_RDONLY) or die "$pwpath: $!\n";
    while (<$F>) {
      chomp;
      my @F = split;
      $PASSWD = $F[1] if $F[0] eq 'action';
    }
    $F->close;
  }
}


sub db_open () {
  $DB = DBI->connect("dbi:SQLite:dbname=$DBPath", '', '',
    { RaiseError => 1, AutoCommit => 1 });
  $DB->do('create table if not exists action_data (
    aid integer not null,
    field text not null,
    value text,
    primary key (aid,field)
    )');
}

sub db_action_exists ($) {
  my($aid) = @_;
  my $count = $DB->selectrow_array(
    'select count(*) from action_data where aid = ?', {}, $aid);
  return $count;
}

sub db_store_action ($$) {
  my($aid, $a) = @_;

  $DB->do('delete from action_data where aid = ?', {}, $aid);
  my $S = $DB->prepare('insert into action_data (aid, field, value)
    values (?,?,?)');
  while (my($k, $v) = each(%$a)) {
    $S->execute($aid, $k, $v);
  }
}

sub db_fetch_action ($) {
  my($aid) = @_;

  return { map(@$_, @{
    $DB->selectall_arrayref(
    'select field,value from action_data where aid=?', {}, $aid) }) };
}

sub db_list_actions () {
  return $DB->selectcol_arrayref('select distinct aid from action_data');
}


sub process_form ($) {
  my($text) = @_;

  %FormInputs = ();
  my $P = new HTML::Parser(start_h => [ sub {
        my($attrs) = @_;
        $FormInputs{$$attrs{name}} = $$attrs{value};
    }, "attr"]);

  $P->parse($text);
}


sub submit_form ($) {
  my($url) = @_;

  my $req = new HTTP::Request(POST => $url);
  $req->content_type('application/x-www-form-urlencoded');
  $req->content(join('&',
      map($_ . '=' . uri_escape($FormInputs{$_}), keys %FormInputs)));
  my $res = $UA->request($req);
  die $res->status_line . "\n" unless $res->is_success;
  $res->content;
}


sub parse_action ($;$) {
  my($text, $update) = @_;
  my(@actions, $action, $sfield, $field, $ftext);

  if (defined($update)) {
    @actions = ($action = $update);
  }

  my $P = new HTML::Parser(
    start_h => [ sub {
        my($tag, $attrs) = @_;

        if (!defined($update) && $tag eq 'tr' &&
          ($$attrs{class} eq 'rgRow' || $$attrs{class} eq 'rgAltRow')) {
          my $rownum = $$attrs{id};
          $rownum =~ s/.*_//;
          $action = {
            _rownum => $rownum,
            #logo_file => $LOGOFILE,
            #logo_data => $LOGODATA,
          };
          unshift(@actions, $action);

        } elsif ($tag eq 'span' && $$attrs{id} =~ /RadGrid.*_ctl\d+_/) {
          $field = $';
          $field =~ s/^EditFormControl_//;
          $field =~ s/Label$//;
          $field =~ s/_displayonly$//;
          $ftext = undef;

        } elsif ($tag eq 'span' && $update) {
          $field = $$attrs{id};
          $ftext = undef;

        } elsif ($tag eq 'select' && $$attrs{id} =~ /RadGrid.*_ctl\d+_/) {
          $sfield = $';
          $sfield =~ s/^EditFormControl_//;
          $sfield =~ s/Label$//;
          $sfield =~ s/_displayonly$//;
          if ($sfield eq 'act_cls_key') { $sfield = '_session' }

        } elsif ($tag eq 'option' && defined $sfield && $$attrs{selected}) {
          $field = $sfield;
          $ftext = undef;

        } elsif ($tag eq 'br') {
          $ftext .= "\n";
        }
      }, "tagname,attr" ],
    end_h => [ sub {
        my($tag) = @_;
        $ftext =~ s/^\s*//;
        $ftext =~ s/\s*$//;
        if (($tag eq 'span' || $tag eq 'option') && defined($field)) {
          if ($ftext ne '' || $$action{$field} eq '') {
            $$action{$field} = $ftext;
          }

        } elsif ($tag eq 'td' && defined($action)
          && !exists($$action{_act_key})) {
          $$action{_act_key} = $ftext;

        } elsif ($tag eq 'td' && defined($action)
          && !exists($$action{_cls_key})) {
          $$action{_cls_key} = $ftext;

        } elsif ($tag eq 'select') {
          $sfield = undef;
        }

        if ($tag ne 'br') {
          $field = undef;
          $ftext = undef;
        }
      }, "tagname" ],
    text_h => [ sub { $ftext .= $_[0] }, "dtext" ],
  );

  $P->parse($text);
  @actions;
}


sub get_action_detail ($$$) {
  my($aid, $rownum, $cls_key) = @_;

  my $req = new HTTP::Request(GET => $GetURL . $aid);
  my $res = $UA->request($req);
  die $res->status_line . "\n" unless $res->is_success;
  return $res->content;
}

sub action_summary($;$) {
  my($a, $extra) = @_;

  my $text = sprintf("#%3d %-5s %8s %-7s %-15s",
    $$a{act_number}, $$a{_date}, $$a{_time}, $$a{act_type},
    $extra ? $$a{_entries_brief} :
    ($$a{_entries_summary} || $$a{_entries_brief}));
  $text .= " $$a{_session}  $$a{act_tech_penalty}" if $extra;
  $text =~ s/\s*$//;
  return $text . "\n"
}

sub action_report($) {
  my($a) = @_;

  return action_summary($a) . "  $$a{_short_desc}\n";
}

sub action_detail($) {
  my($a) = @_;

  my $report = sprintf("  CS:%-3s   SOM:%-3s   COA:%-3s   HOLD:%-3s   REMOVE:%s\n",
    $$a{CsAcked}, $$a{SomComplete}, $$a{CoaComplete}, $$a{HoldResults},
    $$a{act_delete_flag} ? "YES" : "NO");

  $report .= "  $$a{_session}\n";
  $report .= "  $$a{act_tech_penalty}\n" if $$a{act_tech_penalty};
  $report .= "  per $$a{_auth} ($$a{act_gcr_section})\n";
  $report =~ s/per  \(/\(/;
  $report =~ s/\n\s+\(\)\n\Z/\n/;
  return $report;
}

sub print_report ($$) {
  my($template, $fields) = @_;

  my %fields = (%$fields, logo_file => $LOGOFILE, logo_data => $LOGODATA);
  $template =~ s/\@(\w+)\@/$fields{$1}/g;
  my $P = new IO::Pipe;
  $P->writer('lp', "-d$Printer") or die "lp: $!\n";
  print $P $template;
  $P->close;
}


sub process_actions ($) {
  my($text) = @_;
  my(@actions, $report, $summary, $mreport, $count);

  my $start = strftime("%b %d %H:%M", localtime(time));

  process_form($text);
  @actions = parse_action($text);

  foreach my $a (@actions) {
    my $aid = $$a{act_number};
    my $stamp = strftime("%b %d %H:%M", localtime(time));

    if ($UPDATE) {
      #print "$aid / ", join(' ', @ARGV), "\n";
      next unless grep($aid == $_, @ARGV);
    } elsif (db_action_exists($aid)) {
      print "$stamp DUP $aid\n" if $MONITOR && $VERBOSE;
      next;
    }

    # This will get overwritten with a longer form in the detail page
    $$a{_short_desc} = $$a{act_description};

    my $atext = get_action_detail($aid, $$a{_rownum}, $$a{_cls_key});
    if ($GETONLY) {
      print $atext;
      next if $UPDATE;
    }
    parse_action($atext, $a);

    $$a{_session} = $ClassKey{$$a{act_cls_key}} if $$a{_session} eq '';
    ($$a{_date}, $$a{_time}) = split(' ', $$a{act_datetime});
    if    ($$a{act_type} eq 'CSA')     { $$a{_auth} = 'Chief Steward' }
    elsif ($$a{act_type} eq 'RFA')     { $$a{_auth} = 'SOM'           }
    elsif ($$a{act_type} eq 'Protest') { $$a{_auth} = 'SOM'           }
    else                               { $$a{_auth} = $$a{act_type}   }

    # The distinction between protestor and protestee is meaningless to us
    # because only the former is normally filled in except on a protest
    # and because on a protest or appeal, either one could be affected.
    # Further, either of these fields may contain multiple entries!
    # So for our purpose, consolidate into lists of cars, classes, and
    # drivers.

    my @cars    = (split(m{\n}m, $$a{protestorCar}),
                   split(m{\n}m, $$a{protesteeCar}));
    my @classes = (split(m{\n}m, $$a{protestorClass}),
                   split(m{\n}m, $$a{protesteeClass}));
    my @drivers = (split(m{\n}m, $$a{protestor}),
                   split(m{\n}m, $$a{protestee}));
    my @entries = map([ $cars[$_], $classes[$_], $drivers[$_] ], 0.. $#cars);
    #$$a{_entries_split} = [ @entries ];
    #$$a{_entries_full}  = [ map("#$$_[0] $$_[1] $$_[2]", @entries) ];
    my @_entries_full  = map("#$$_[0] $$_[1] $$_[2]", @entries);
    $$a{_entries_brief} = join(', ', map("#$$_[0] $$_[1]", @entries));
    $$a{_entries_summary} = @entries > 1 ? $$a{_entries_brief} : $_entries_full[0];

    if (@entries) {
      foreach (@_entries_full) {
        $$a{__entries__} .= "() ($_) Field newline\n";
      }
      $$a{__entries__} =~ s/^\(\)/(Car(s))/;
    } else {
      $$a{__entries__} = "(Car(s)) ((none listed)) Field newline\n";
    }

    my $desc = wrap('', '', $$a{act_description});
    $desc =~ s/\n*$//;
    foreach (split(/\n/, $desc)) {
      $$a{__details__} .= "() ($_) Field newline\n";
    }
    $$a{__details__} =~ s/^\(\)/(Details)/;

    $report = action_report($a);

    if (!$UPDATE && (
        $$a{act_number} eq '' || !$$a{act_datetime} ||
        !$$a{act_type} || !$$a{act_initiated_by} || !@entries)) {
      $report .= "  NOT READY\n";
      $mreport .= "$stamp $report";
      print $report if $VERBOSE;
      next;
    }

    $summary .= $report;
    $mreport .= "$stamp $report";
    print $report if $VERBOSE;
    $count++;

    $report = action_detail($a);
    $summary .= $report;
    print $report if $VERBOSE;

    $summary .= "\n";
    print "\n" if $VERBOSE;

    if ($DEBUG) {
      print STDERR "Action $aid:\n";
      print STDERR map(sprintf("  %-20s  %s\n", "$_:", $$a{$_}), sort keys %$a);
      print STDERR "\n";
    }

    if ($FORCE || ! db_action_exists($aid)) {
      db_store_action($aid, $a);
      print_report($Template, $a) if $Printer;
    }
  }


  if ($MONITOR) {
    my $done = strftime("%b %d %H:%M", localtime(time));
    print $mreport unless $VERBOSE;
    printf "%s -> %s %d actions\n", $start, $done, $count;
  }
  if ($REPORT && $Printer && $summary) {
    # Print a summary report
    my $P = new IO::Pipe;
    $P->writer('lp', "-d$Printer") or die "lp: $!\n";
    print $P ' ' x 25, "*** ACTION SUMMARY REPORT ***\n";
    print $P $summary;
    $P->close;
  }
}

sub list_actions () {
  my(@list);

  if (@ARGV) {
    @list = sort { $a <=> $b } (@ARGV);
  } else {
    my $list = db_list_actions();
    return unless $list;
    @list = sort { $a <=> $b } (@$list);
  }

  foreach my $a (map(db_fetch_action($_), @list)) {
    print action_summary($a, !$VERBOSE);
    print action_detail($a), "\n" if $VERBOSE;
  }
}


sub print_actions () {
  die "Please list action(s) to print\n" unless @ARGV;
  my @list = sort { $a <=> $b } (@ARGV);

  foreach my $a (map(db_fetch_action($_), @list)) {
    if ($Printer) {
      print_report($Template, $a);
    } else {
      print action_summary($a, 0);
      print action_detail($a), "\n";
    }
  }
}


sub get_data () {
  my $req = new HTTP::Request(GET => $ListURL);
  my $res = $UA->request($req);
  die $res->status_line . "\n" unless $res->is_success;
  my $text = $res->content;

  if ($text =~ /type="password"/) {
    process_form($res->content);
    foreach (grep(/userid/i,   keys %FormInputs)) { $FormInputs{$_} = $USERID }
    foreach (grep(/password/i, keys %FormInputs)) { $FormInputs{$_} = $PASSWD }
    $text = submit_form($LoginURL);
  }

  return $text;
}

parse_args;

{
  my $F = new IO::File($LOGOPATH, O_RDONLY);
  if ($F) { $F->read($LOGODATA, ($F->stat())[7]) }
  else    { warn "$LOGOPATH: $!\n" }
}


## Fetch the data file
$UA = new LWP::UserAgent;
$UA->cookie_jar( {} );
push @{ $UA->requests_redirectable }, 'POST';
$UA->show_progress(1);

db_open();
if ($UPDATE) {
  process_actions(get_data());
} elsif ($LIST > 1) {
  print_actions();
} elsif ($LIST) {
  list_actions();
} elsif ($GETONLY) {
  print get_data();
} elsif (@ARGV) {
  process_actions(join('', <>));
} elsif ($MONITOR) {
  while (1) {
    process_actions(get_data());
    sleep(30);
  }
} else {
  process_actions(get_data());
}

__DATA__
%!PS-Adobe-3.0
%%Creator: changemon
%%DocumentNeededResources: font Helvetica-Bold
%%Pages: 1
%%BeginProlog
/inch {72 mul} def

/doFont { findfont exch scalefont setfont } def
%             size face       
/TitleFont  {   18 /Helvetica-Bold  doFont } def
/LabelFont  {   11 /Helvetica-Bold  doFont } def
/FieldFont  {   11 /Helvetica       doFont } def

/newline { /vpos vpos 0.34 inch sub def } def
/Field { 
  % Label Value
  LabelFont 2.25 inch vpos moveto show
  FieldFont 0.75 inch vpos moveto show
} def
/Field2 { 
  % Label Value
  LabelFont 6.00 inch vpos moveto show
  FieldFont 4.50 inch vpos moveto show
} def

/BeginEPSF { %def
  /b4_Inc_state save def                % Save state for cleanup
  /dict_count countdictstack def        % Count objects on dict stack
  /op_count count 1 sub def             % Count objects on operand stack
  userdict begin                        % Push userdict on dict stack
  /showpage { } def                     % Redefine showpage, { } = null proc
  0 setgray 0 setlinecap                % Prepare graphics state
  1 setlinewidth 0 setlinejoin
  10 setmiterlimit [ ] 0 setdash newpath
  /languagelevel where                  % If level not equal to 1 then
  {pop languagelevel                    % set strokeadjust and
  1 ne                                  % overprint to their defaults.
    {false setstrokeadjust false setoverprint
    } if
  } if
} bind def

/EndEPSF { %def
  count op_count sub {pop} repeat       % Clean up stacks
  countdictstack dict_count sub {end} repeat
  b4_Inc_state restore
} bind def
%%EndProlog
%%BeginSetup
%%IncludeResource: font Helvetica-Bold
%%EndSetup
%%Page: 1 1

% Runoffs Logo -- copy bbox from logo EPS header
/logo_bbox {0 0 326 176} def
/logo_scale 0.30 def

BeginEPSF
% logo_bbox
% 3 -1 roll sub logo_scale mul 10.75 inch exch sub
% 3 1 roll exch sub logo_scale mul 8.25 inch exch sub
% exch translate
.25 inch 10.75 inch
logo_bbox exch pop exch sub exch pop
logo_scale mul sub translate
logo_scale dup scale
logo_bbox pop pop neg exch neg exch translate
%%BeginDocument: @logo_file@
@logo_data@
%%EndDocument
EndEPSF

% Page Title
TitleFont
(ACTION)
dup stringwidth pop
8.5 inch exch sub 2 div
9.75 inch 
moveto show

/vpos 9.10 inch def
(Action Number)       (@act_number@)       Field
(Received)            (@act_datetime@)     Field2 newline
(Type)                (@act_type@)         Field
(Initiated By)        (@act_initiated_by@) Field2 newline
(Session)             (@_session@)         Field  newline
@__entries__@
(Penalty)             (@act_tech_penalty@) Field  newline
(GCR/Supp Ref.)       (@act_gcr_section@)  Field  newline
(By order of)         (@_auth@)            Field  newline
@__details__@

(Cleared)        2.25 inch 3.19 inch moveto show
(Withdrawn)      2.25 inch 2.96 inch moveto show
3.8 inch 3.19 inch moveto 4.5 inch 3.19 inch lineto stroke
3.8 inch 2.96 inch moveto 4.5 inch 2.96 inch lineto stroke

(Orbits A)       2.25 inch 2.50 inch moveto show (by) 4.75 inch 2.50 inch moveto show
(Orbits B)       2.25 inch 2.27 inch moveto show (by) 4.75 inch 2.27 inch moveto show
(Orbits C)       2.25 inch 2.04 inch moveto show (by) 4.75 inch 2.04 inch moveto show
(Excel database) 2.25 inch 1.81 inch moveto show (by) 4.75 inch 1.81 inch moveto show

3.8 inch 2.50 inch moveto 4.5 inch 2.50 inch lineto stroke
3.8 inch 2.27 inch moveto 4.5 inch 2.27 inch lineto stroke
3.8 inch 2.04 inch moveto 4.5 inch 2.04 inch lineto stroke
3.8 inch 1.81 inch moveto 4.5 inch 1.81 inch lineto stroke

5.25 inch 2.50 inch moveto 6.625 inch 2.50 inch lineto stroke
5.25 inch 2.27 inch moveto 6.625 inch 2.27 inch lineto stroke
5.25 inch 2.04 inch moveto 6.625 inch 2.04 inch lineto stroke
5.25 inch 1.81 inch moveto 6.625 inch 1.81 inch lineto stroke

showpage
%%Trailer
%%Pages: 1
